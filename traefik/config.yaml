http:
  middlewares:    
    default-security-headers:
      headers:
        customBrowserXSSValue: 0
        contentTypeNosniff: true
        forceSTSHeader: true
        frameDeny: false
        referrerPolicy: "strict-origin-when-cross-origin"
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        contentSecurityPolicy: "default-src 'self'"     
        customRequestHeaders:
          X-Forwarded-Proto: https
    https-redirectscheme:
      redirectScheme:
        scheme: https
        permanent: true
    crowdsec-bouncer:
      forwardAuth:
        address: http://crowdsec-bouncer:8080/api/v1/forwardAuth
        trustForwardHeader: true
    authentik:
      forwardAuth:
        address: http://authentik-server:9000/outpost.goauthentik.io/auth/traefik
        trustForwardHeader: true
        authResponseHeaders:
          - X-authentik-username
          - X-authentik-groups
          - X-authentik-email
          - X-authentik-name
          - X-authentik-uid
          - X-authentik-jwt
          - X-authentik-meta-jwks
          - X-authentik-meta-outpost
          - X-authentik-meta-provider
          - X-authentik-meta-app
          - X-authentik-meta-version

  routers:
    pfsense:
      entryPoints:
        - "https"
      rule: "Host(`pfsense.local.codistech.live`)"
      middlewares:
        - https-redirectscheme
        - crowdsec-bouncer
      tls: {}
      service: pfsense

    proxmox:
      entryPoints:
        - "https"
      rule: "Host(`proxmox.local.codistech.live`)"
      middlewares:
        - https-redirectscheme
        - crowdsec-bouncer
      tls: {}
      service: proxmox

    unifi:
      entryPoints:
        - "https"
      rule: "Host(`unifi.local.codistech.live`)"
      middlewares:
        - https-redirectscheme
        - crowdsec-bouncer
      tls: {}
      service: unifi

    unraid:
      entryPoints:
        - "https"
      rule: "Host(`unraid.local.codistech.live`)"
      middlewares:
        - https-redirectscheme
        - crowdsec-bouncer
      tls: {}
      service: unraid

    pihole1:
      entryPoints:
        - "https"
      rule: "Host(`pihole1.local.codistech.live`)"
      middlewares:
        - https-redirectscheme
        - crowdsec-bouncer
      tls: {}
      service: pihole1

    pihole2:
      entryPoints:
        - "https"
      rule: "Host(`pihole2.local.codistech.live`)"
      middlewares:
        - https-redirectscheme
        - crowdsec-bouncer
      tls: {}
      service: pihole2

    nextcloud:
      entryPoints:
        - "https"
      rule: "Host(`nextcloud.local.codistech.live`)"
      middlewares:
        - https-redirectscheme
        - crowdsec-bouncer
      tls: {}
      service: nextcloud

  services:

    pfsense:
      loadBalancer:
        servers:
          - url: "https://192.168.0.1:10443"
        passHostHeader: true

    proxmox:
      loadBalancer:
        servers:
          - url: "https://192.168.0.90:8006"
        passHostHeader: true

    unifi:
      loadBalancer:
        servers:
          - url: "https://192.168.0.100:11443"
        serversTransport: unifi-transport

    unraid:
      loadBalancer:
        servers:
          - url: "http://192.168.0.50:8085"
        passHostHeader: true

    pihole1:
      loadBalancer:
        servers:
          - url: "http://192.168.0.55:8080"
        passHostHeader: true

    pihole2:
      loadBalancer:
        servers:
          - url: "http://192.168.0.70:8080"
        passHostHeader: true

    nextcloud:
      loadBalancer:
        servers:
          - url: "https://192.168.0.50:444"
        serversTransport: nextcloud-transport    

  serversTransports:
    unifi-transport:
      insecureSkipVerify: true
    nextcloud-transport:
      insecureSkipVerify: true